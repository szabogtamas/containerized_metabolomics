---
title: "Basic comparison of metabolomic profiles"
output: html_notebook
---

```{r}
library(MetaboAnalystR)

library(dplyr)
library(tidyr)
library(stringr)
```

```{r}
test_data_file <- "data_examples/test.tsv"
```

```{r}
metab_data <- test_data_file %>%
  read.table(sep="\t", stringsAsFactors=FALSE, header=TRUE) %>%
  rename(Metabolite = X, MetaboGroup = X.1) %>%
  pivot_longer(c(-Metabolite, -MetaboGroup)) %>%
  mutate(
    Condition = str_extract(name, 'Condition(A|B)'),
    Replicate = case_when(
      grepl('\\.1', name) ~ 'Batch_2',
      TRUE ~ 'Batch_1'
    )
  ) %>%
  select(-name)

head(metab_data)
```

```{r}
mSet <- InitDataObjects("conc", "msetquea", FALSE)  %>%
  ReadIndData(metab_data)
```

```{r}
# Perform data processing - Data checking
mSet <- SanityCheckData(mSet)
```

```{r}
# Perform data processing - Minimum Value Replacing
mSet <- ReplaceMin(mSet)
```

```{r}
# Perform data processing - Variable Filtering and Normalization
mSet <- FilterVariable(mSet, "iqr", "F", 25)
mSet <- PreparePrenormData(mSet)
mSet <- Normalization(mSet, "MedianNorm", "LogNorm", "NULL", ratio=FALSE, ratioNum=20)
```

```{r}
mSet <- PlotNormSummary(mSet, "norm_0_", "png", 72, width=NA)
mSet <- PlotSampleNormSummary(mSet, "snorm_0_", "png", 72, width=NA)
```

```{r}
mSet <- PlotNormSummary(mSet, "norm_0_", "png", 72, width=NA)
mSet <- PlotSampleNormSummary(mSet, "snorm_0_", "png", 72, width=NA)
```

```{r}
mSet <- PlotNormSummary(mSet, "norm_0_", "png", 72, width=NA)
mSet <- PlotSampleNormSummary(mSet, "snorm_0_", "png", 72, width=NA)
```
